name: Test Google Drive Connection
on: workflow_dispatch  # Cho phép bấm nút chạy thủ công

jobs:
  test_drive:
    runs-on: ubuntu-latest
    steps:
      # 1. Lấy code về
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Cài Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. Cài thư viện cần thiết cho Google Drive
      - name: Install Libraries
        run: pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib

      # 4. TẠO FILE KEY TỪ SECRET (Quan trọng nhất)
      # GitHub không cho up file json key lên, nên phải tạo lại từ Secret
      - name: Create Service Account File
        run: echo '${{ secrets.GDRIVE_CREDS }}' > service_account.json

      # 5. CHẠY FILE TEST
      - name: Run Test Script
        run: python test_drive.py
